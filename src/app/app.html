<!-- loader -->
@if(tasksSrv.loader()){
<app-loader></app-loader>
}

<main>
  <!-- left sec-1 -> add-task component -->
  <app-add-task></app-add-task>

  <!-- right lists container -->
  <div class="lists" [ngStyle]="{ background: tasksSrv.sec2Color }">
    <button class="paint" (click)="tasksSrv.showColorsListaToggle()">
      <img src="brush.png" alt="brush" />
    </button>

    @if(tasksSrv.changeListsColor()){
    <div class="color-change">
      <div class="colors">
        <div
          class="single-color green"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(10, 77, 17), rgb(79, 208, 101))'
            )
          "
        ></div>
        <div
          class="single-color yellow"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(128, 108, 0), rgb(255, 235, 59))'
            )
          "
        ></div>
        <div
          class="single-color orange"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(153, 61, 0), rgb(255, 145, 77))'
            )
          "
        ></div>
        <div
          class="single-color red"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(77, 17, 27), rgb(208, 79, 101))'
            )
          "
        ></div>
        <div
          class="single-color purple"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(60, 0, 77), rgb(170, 79, 208))'
            )
          "
        ></div>
        <div
          class="single-color blue"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(17, 40, 77), rgb(79, 150, 208))'
            )
          "
        ></div>
        <div
          class="single-color teal"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(0, 77, 64), rgb(77, 208, 180))'
            )
          "
        ></div>
        <div
          class="single-color cyan"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(0, 77, 92), rgb(79, 208, 231))'
            )
          "
        ></div>
        <div
          class="single-color pink"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(128, 20, 77), rgb(255, 128, 191))'
            )
          "
        ></div>
        <div
          class="single-color black"
          (click)="
            tasksSrv.changeSec2Color(
              'linear-gradient(to bottom, rgb(51, 51, 51), rgb(180, 180, 180))'
            )
          "
        ></div>
      </div>
    </div>
    }

    <header class="header">
      <div>My Todo Board</div>
      <div class="add-section" (click)="tasksSrv.addSection()">
        <img
          [ngClass]="{ 'settings-spin': tasksSrv.newSection() }"
          class="settings"
          src="settings.png"
          alt="settings"
        />
        <img
          [ngClass]="{ 'add-spin': tasksSrv.newSection() }"
          class="add"
          src="add-white.png"
          alt="add"
        />
        <span class="tooltip">Add New Section</span>
      </div>
    </header>

    <div class="main-div">
      <!-- Today component -->
      @if(tasksSrv.todayExist && !tasksSrv.todayCollapsed()){
      <app-today></app-today>
      }@else{
      <div
        class="hidden-section"
        (click)="tasksSrv.toggleTodayCollapsed()"
        [ngStyle]="{ background: tasksSrv.secTodayColor }"
      >
        <button class="size zoom">
          <img src="zoom.png" alt="zoom" />
        </button>
        <div class="title-text">{{ tasksSrv.todayTitle || "Today" }}</div>
        <div class="tasks-num">{{ tasksSrv.todayTasks().length }}</div>
      </div>
      }

      <!-- All added sections -> add-section component renders them -->
      <app-add-section></app-add-section>
    </div>
  </div>
</main>

<!-- Undo -->
@if (tasksSrv.showUndoMessage()) {
<app-undo></app-undo>
}

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- @if(loader()){
<div class="loader">
  <div class="spin-1"></div>
  <div class="spin-2"></div>
  <div class="spin-3"></div>
</div>
}

<main>
  <section
    class="sec-1"
    (dragover)="onDragOver($event)"
    (drop)="dropTaskToMainList('tasks', getDropIndex($event, 'tasks'))"
    [ngStyle]="{ 'background-color': sec1Color }"
  >
    <button class="paint" (click)="showColors()">
      <img src="brush.png" alt="brush" />
    </button>

    @if(changeColors()){
     <div class="color-change">
      

      <div class="colors">
        <div class="single-color green"></div>
        <div class="single-color yellow"></div>
        <div class="single-color orange"></div>
        <div class="single-color red"></div>
        <div class="single-color purple"></div>
        <div class="single-color blue"></div>
        <div class="single-color teal"></div>
        <div class="single-color cyan"></div>
        <div class="single-color pink"></div>
        <div class="single-color black"></div>
      </div>
    </div> 

    <div class="color-change">
      <div class="colors">
        <div
          class="single-color green"
          (click)="changeSec1Color('rgb(4, 174, 103)')"
        ></div>
        <div
          class="single-color yellow"
          (click)="changeSec1Color('rgb(195, 189, 17)')"
        ></div>
        <div
          class="single-color orange"
          (click)="changeSec1Color('rgb(201, 129, 6)')"
        ></div>
        <div
          class="single-color red"
          (click)="changeSec1Color('rgb(148, 17, 7)')"
        ></div>
        <div
          class="single-color purple"
          (click)="changeSec1Color('rgb(49, 5, 72)')"
        ></div>
        <div
          class="single-color blue"
          (click)="changeSec1Color('rgb(19, 17, 60)')"
        ></div>
        <div class="single-color teal" (click)="changeSec1Color('teal')"></div>
        <div class="single-color cyan" (click)="changeSec1Color('cyan')"></div>
        <div
          class="single-color pink"
          (click)="changeSec1Color('rgb(226, 159, 170)')"
        ></div>
        <div class="single-color black" (click)="changeSec1Color('gray')"></div>
      </div>
    </div>
    }

    <form class="title" (ngSubmit)="addTask()">
      <input type="text" name="task-input" [(ngModel)]="newTask" />
      <button type="submit">Add Task</button>
    </form>

    @for(task of tasks; track $index){
    <div
      class="task-div"
      draggable="true"
      (dragstart)="onDragStart($index, 'tasks')"
      (mouseenter)="task.hover = true"
      (mouseleave)="task.hover = false"
      [ngStyle]="{
        border: task.hover
          ? '2px solid rgba(255, 255, 255, 0.556)'
          : '2px solid rgb(33, 29, 29)'
      }"
    >
        
      @if(!task.saved){
      <button
        class="circle"
        (click)="makeDeleteVisible($index)"
        [ngStyle]="{
          opacity: task.marked || task.hover ? '1' : '0'
        }"
      >
          
        @if(task.marked){
        <img class="mark" src="checkmark.png" alt="checkmark" />
        }
      </button>
      }
      <div
        class="task"
        [ngStyle]="{
          padding: task.marked || task.hover && !task.saved ? '6px 6px 6px 20px' : '6px 0px',
        }"
      >
        @if(!task.saved){
        {{ task.task }}
        }@else {
        <form class="edit-form" (ngSubmit)="saveTask($index)">
          <input
            class="task-edit"
            type="text"
            name="task-input"
            [(ngModel)]="task.task"
          />
        </form>
        }
      </div>
      @if(task.marked && task.hover && !task.saved){
      <button class="delete" (click)="deleteTask($index)">
        <img src="delete.png" alt="delete-icon" />
      </button>
      }
        
      @if(task.hover && !task.saved){
      <button class="edit" (click)="editTask($index)">
        <img src="pen.png" alt="edit" />
      </button>
      }
        
      @if(task.saved){
      <button class="save" (click)="saveTask($index)">
        <img src="save.png" alt="save" />
      </button>
      }
    </div>
    }
  </section>
 
  <div class="lists" [ngStyle]="{ background: sec2Color }">
    <button class="paint" (click)="showColorsLista()">
      <img src="brush.png" alt="brush" />
    </button>

    @if(changeListsColor()){
     <div class="color-change">
      

      <div class="colors">
        <div class="single-color green"></div>
        <div class="single-color yellow"></div>
        <div class="single-color orange"></div>
        <div class="single-color red"></div>
        <div class="single-color purple"></div>
        <div class="single-color blue"></div>
        <div class="single-color teal"></div>
        <div class="single-color cyan"></div>
        <div class="single-color pink"></div>
        <div class="single-color black"></div>
      </div>
    </div> 

    <div class="color-change">
      <div class="colors">
        <div
          class="single-color green"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(10, 77, 17), rgb(79, 208, 101))'
            )
          "
        ></div>
        <div
          class="single-color yellow"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(128, 108, 0), rgb(255, 235, 59))'
            )
          "
        ></div>
        <div
          class="single-color orange"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(153, 61, 0), rgb(255, 145, 77))'
            )
          "
        ></div>
        <div
          class="single-color red"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(77, 17, 27), rgb(208, 79, 101))'
            )
          "
        ></div>
        <div
          class="single-color purple"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(60, 0, 77), rgb(170, 79, 208))'
            )
          "
        ></div>
        <div
          class="single-color blue"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(17, 40, 77), rgb(79, 150, 208))'
            )
          "
        ></div>
        <div
          class="single-color teal"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(0, 77, 64), rgb(77, 208, 180))'
            )
          "
        ></div>
        <div
          class="single-color cyan"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(0, 77, 92), rgb(79, 208, 231))'
            )
          "
        ></div>
        <div
          class="single-color pink"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(128, 20, 77), rgb(255, 128, 191))'
            )
          "
        ></div>
        <div
          class="single-color black"
          (click)="
            changeSec2Color(
              'linear-gradient(to bottom, rgb(51, 51, 51), rgb(180, 180, 180))'
            )
          "
        ></div>
      </div>
    </div>
    }

    <header class="header">
      <div>My Todo Board</div>

      <div class="add-section" (click)="addSection()">
        <img
          [ngClass]="{ 'settings-spin': newSection() }"
          class="settings"
          src="settings.png"
          alt="settings"
        />
        <img
          [ngClass]="{ 'add-spin': newSection() }"
          class="add"
          src="add-white.png"
          alt="add"
        />

        <span class="tooltip">Add New Section</span>
      </div>
    </header>

    <div class="main-div">
      @if(todayExist && !todayCollapsed()){
      <section
        class="sec-2"
        (dragover)="onDragOver($event)"
        (drop)="
          dropTaskToMainList('todayTasks', getDropIndex($event, 'todayTasks'))
        "
        [ngStyle]="{ background: secTodayColor }"
      >
        <button class="paint" (click)="showColorsToday()">
          <img src="brush.png" alt="brush" />
        </button>

        @if(changeTodayColor()){
         <div class="color-change">
        
  
        <div class="colors">
          <div class="single-color green"></div>
          <div class="single-color yellow"></div>
          <div class="single-color orange"></div>
          <div class="single-color red"></div>
          <div class="single-color purple"></div>
          <div class="single-color blue"></div>
          <div class="single-color teal"></div>
          <div class="single-color cyan"></div>
          <div class="single-color pink"></div>
          <div class="single-color black"></div>
        </div>
      </div> 

        <div class="color-change">
          <div class="colors">
            <div
              class="single-color green"
              (click)="changeSecTodayColor('rgb(4, 174, 103)')"
            ></div>
            <div
              class="single-color yellow"
              (click)="changeSecTodayColor('rgb(195, 189, 17)')"
            ></div>
            <div
              class="single-color orange"
              (click)="changeSecTodayColor('rgb(201, 129, 6)')"
            ></div>
            <div
              class="single-color red"
              (click)="changeSecTodayColor('rgb(148, 17, 7)')"
            ></div>
            <div
              class="single-color purple"
              (click)="changeSecTodayColor('rgb(49, 5, 72)')"
            ></div>
            <div
              class="single-color blue"
              (click)="changeSecTodayColor('rgb(19, 17, 60)')"
            ></div>
            <div
              class="single-color teal"
              (click)="changeSecTodayColor('teal')"
            ></div>
            <div
              class="single-color cyan"
              (click)="changeSecTodayColor('cyan')"
            ></div>
            <div
              class="single-color pink"
              (click)="changeSecTodayColor('rgb(226, 159, 170)')"
            ></div>
            <div
              class="single-color black"
              (click)="changeSecTodayColor('gray')"
            ></div>
          </div>
        </div>
        }

        <div class="section-header">
          @if(!todayClickOnTitle){
          <form class="title" (click)="changeTodayTitle()">
            {{ todayTitle || "Today" }}
          </form>
          }@else{
          <form class="title title-form" (ngSubmit)="saveTodayTitle()">
            <input
              type="text"
              [(ngModel)]="todayTitle"
              autofocus
              name="edit-today"
              [value]="todayTitle"
            />
          </form>
          }

           <div class="change-size"> 
          <button class="size hide" (click)="toggleTodayCollapsed()">
            <img src="hide.png" alt="hide" />
          </button>
           </div> 

          <button class="delete-section" (click)="deleteTodaySection()">
            <img src="delete.png" alt="delete-section" />
          </button>
        </div>

        @for(task of todayTasks; track $index){
        <div
          class="task-div"
          draggable="true"
          (dragstart)="onDragStart($index, 'todayTasks')"
          (mouseenter)="task.hover = true"
          (mouseleave)="task.hover = false"
          [ngStyle]="{
            border: task.hover
              ? '2px solid rgba(255, 255, 255, 0.556)'
              : '2px solid rgb(33, 29, 29)'
          }"
        >
            
          @if(!task.saved){
          <button
            class="circle"
            (click)="makeDeleteVisibleToday($index)"
            [ngStyle]="{
              opacity: task.marked || task.hover ? '1' : '0'
            }"
          >
              
            @if(task.marked){
            <img class="mark" src="checkmark.png" alt="checkmark" />
            }
          </button>
          }
          <div
            class="task"
            [ngStyle]="{
          padding: task.marked || task.hover && !task.saved ? '6px 6px 6px 20px' : '6px 0px',
        }"
          >
            @if(!task.saved){
            {{ task.task }}
            }@else {
            <form class="edit-form" (ngSubmit)="saveTaskToday($index)">
              <input
                class="task-edit"
                type="text"
                name="task-input"
                [(ngModel)]="task.task"
              />
            </form>
            }
          </div>
          @if(task.marked && task.hover && !task.saved){
          <button class="delete" (click)="deleteTaskToday($index)">
            <img src="delete.png" alt="delete-icon" />
          </button>
          }
            
          @if(task.hover && !task.saved){
          <button class="edit" (click)="editTaskToday($index)">
            <img src="pen.png" alt="edit" />
          </button>
          }
            
          @if(task.saved){
          <button class="save" (click)="saveTaskToday($index)">
            <img src="save.png" alt="save" />
          </button>
          }
        </div>
        }
      </section>
      }@else {
      <div
        class="hidden-section"
        (click)="toggleTodayCollapsed()"
        [ngStyle]="{ background: secTodayColor }"
      >
        <button class="size zoom">
          <img src="zoom.png" alt="zoom" />
        </button>
        <div class="title-text">{{ todayTitle || "Today" }}</div>
        <div class="tasks-num">{{ todayTasks.length }}</div>
      </div>
      }

       //////////////////////////////////////////////////////////////////////////////// 
      @for(list of newSectionArray(); track $index; let sectionIndex = $index){
        
      @if(list.exist && !list.collapsed){
      <section
        class="sec-2"
        (dragover)="onDragOver($event)"
        [ngStyle]="{ 'background-color': list.color }"
        (drop)="
          dropTaskToSection(
            sectionIndex,
            getDropIndex($event, 'section', sectionIndex)
          )
        "
      >
        <button class="paint" (click)="showSectionColorPicker(sectionIndex)">
          <img src="brush.png" alt="brush" />
        </button>

        @if(showSectionColors[sectionIndex]){
         <div class="color-change">
      

      <div class="colors">
        <div class="single-color green"></div>
        <div class="single-color yellow"></div>
        <div class="single-color orange"></div>
        <div class="single-color red"></div>
        <div class="single-color purple"></div>
        <div class="single-color blue"></div>
        <div class="single-color teal"></div>
        <div class="single-color cyan"></div>
        <div class="single-color pink"></div>
        <div class="single-color black"></div>
      </div>
    </div> 

        <div class="color-change">
          <div class="colors">
            <div
              class="single-color green"
              (click)="changeSectionColor(sectionIndex, 'rgb(4, 174, 103)')"
            ></div>
            <div
              class="single-color yellow"
              (click)="changeSectionColor(sectionIndex, 'rgb(195, 189, 17)')"
            ></div>
            <div
              class="single-color orange"
              (click)="changeSectionColor(sectionIndex, 'rgb(201, 129, 6)')"
            ></div>
            <div
              class="single-color red"
              (click)="changeSectionColor(sectionIndex, 'rgb(148, 17, 7)')"
            ></div>
            <div
              class="single-color purple"
              (click)="changeSectionColor(sectionIndex, 'rgb(49, 5, 72)')"
            ></div>
            <div
              class="single-color blue"
              (click)="changeSectionColor(sectionIndex, 'rgb(19, 17, 60)')"
            ></div>
            <div
              class="single-color teal"
              (click)="changeSectionColor(sectionIndex, 'teal')"
            ></div>
            <div
              class="single-color cyan"
              (click)="changeSectionColor(sectionIndex, 'cyan')"
            ></div>
            <div
              class="single-color pink"
              (click)="changeSectionColor(sectionIndex, 'rgb(226, 159, 170)')"
            ></div>
            <div
              class="single-color black"
              (click)="changeSectionColor(sectionIndex, 'gray')"
            ></div>
          </div>
        </div>
        }

        <div class="section-header">
          @if(!list.clickOnTitle){
          <form class="title" (click)="changeTitle(sectionIndex)">
            {{ list.title || "New Section" }}
          </form>
          }@else{
          <form
            class="title title-form"
            (ngSubmit)="saveSectionTitle(sectionIndex)"
          >
            <input
              type="text"
              [(ngModel)]="list.title"
              autofocus
              name="edit-{{ sectionIndex }}"
              [value]="list.title"
            />
          </form>
          }

            
          <button
            class="size hide"
            (click)="toggleSectionCollapsed(sectionIndex)"
          >
            <img src="hide.png" alt="hide" />
          </button>

          <button class="delete-section" (click)="deleteSection(sectionIndex)">
            <img src="delete.png" alt="delete-section" />
          </button>
        </div>

        @for(task of list.tasks; track $index; let taskIndex = $index){
        <div
          class="task-div"
          draggable="true"
          (dragstart)="onDragStartFromSection(taskIndex, sectionIndex)"
          (mouseenter)="task.hover = true"
          (mouseleave)="task.hover = false"
          [ngStyle]="{
            border: task.hover
              ? '2px solid rgba(255, 255, 255, 0.556)'
              : '2px solid rgb(33, 29, 29)'
          }"
        >
            
          @if(!task.saved){
          <button
            class="circle"
            (click)="makeDeleteVisibleAddedSection(sectionIndex, taskIndex)"
            [ngStyle]="{
              opacity: task.marked || task.hover ? '1' : '0'
            }"
          >
              
            @if(task.marked){
            <img class="mark" src="checkmark.png" alt="checkmark" />
            }
          </button>
          }
          <div
            class="task"
            [ngStyle]="{
          padding: task.marked || task.hover && !task.saved ? '6px 6px 6px 20px' : '6px 0px',
        }"
          >
            @if(!task.saved){
            {{ task.task }}
            }@else {
            <form
              class="edit-form"
              (ngSubmit)="saveTaskFromSection(sectionIndex, taskIndex)"
            >
              <input
                class="task-edit"
                type="text"
                name="task-input"
                [(ngModel)]="task.task"
              />
            </form>
            }
          </div>
          @if(task.marked && task.hover && !task.saved){
          <button
            class="delete"
            (click)="deleteTaskFromSection(sectionIndex, taskIndex)"
          >
            <img src="delete.png" alt="delete-icon" />
          </button>
          }
            
          @if(task.hover && !task.saved){
          <button
            class="edit"
            (click)="editTaskFromSection(sectionIndex, taskIndex)"
          >
            <img src="pen.png" alt="edit" />
          </button>
          }
            
          @if(task.saved){
          <button
            class="save"
            (click)="saveTaskFromSection(sectionIndex, taskIndex)"
          >
            <img src="save.png" alt="save" />
          </button>
          }
        </div>
        }
      </section>
      }@else if(list.exist){
      <div
        class="hidden-section"
        (click)="toggleSectionCollapsed(sectionIndex)"
        [ngStyle]="{ 'background-color': list.color }"
      >
        <button class="size zoom">
          <img src="zoom.png" alt="zoom" />
        </button>
        <div class="title-text">{{ list.title || "New Section" }}</div>
        <div class="tasks-num">{{ list.tasks.length }}</div>
      </div>
      } }
    </div>
  </div>
</main>

@if (showUndoMessage()) {
<div class="undo">
  <img class="info" src="info.png" alt="info" />
  <img
    class="close"
    src="close-icon.png"
    alt="close-icon"
    (click)="closeUndo()"
  />
  <p>Task Achieved</p>
  <button (click)="undoDelete()">UNDO</button>
</div>
} -->
