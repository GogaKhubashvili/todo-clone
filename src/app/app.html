<main>
  <section
    class="sec-1"
    (dragover)="onDragOver($event)"
    (drop)="dropTaskToMainList('tasks', getDropIndex($event, 'tasks'))"
  >
    <form class="title" (ngSubmit)="addTask()">
      <input type="text" name="task-input" [(ngModel)]="newTask" />
      <button type="submit">Add Task</button>
    </form>

    @for(task of tasks; track $index){
    <div
      class="task-div"
      draggable="true"
      (dragstart)="onDragStart($index, 'tasks')"
      (mouseenter)="task.hover = true"
      (mouseleave)="task.hover = false"
      [ngStyle]="{
        border: task.hover
          ? '2px solid rgba(255, 255, 255, 0.556)'
          : '2px solid rgb(33, 29, 29)'
      }"
    >
      <!--  -->
      @if(!task.saved){
      <button
        class="circle"
        (click)="makeDeleteVisible($index)"
        [ngStyle]="{
          opacity: task.marked || task.hover ? '1' : '0'
        }"
      >
        <!--  -->
        @if(task.marked){
        <img class="mark" src="checkmark.png" alt="checkmark" />
        }
      </button>
      }
      <div
        class="task"
        [ngStyle]="{
          padding: task.marked || task.hover && !task.saved ? '6px 6px 6px 20px' : '6px 0px',
        }"
      >
        @if(!task.saved){
        {{ task.task }}
        }@else {
        <form class="edit-form" (ngSubmit)="saveTask($index)">
          <input
            class="task-edit"
            type="text"
            name="task-input"
            [(ngModel)]="task.task"
          />
        </form>
        }
      </div>
      @if(task.marked && task.hover && !task.saved){
      <button class="delete" (click)="deleteTask($index)">
        <img src="delete.png" alt="delete-icon" />
      </button>
      }
      <!--  -->
      @if(task.hover && !task.saved){
      <button class="edit" (click)="editTask($index)">
        <img src="pen.png" alt="edit" />
      </button>
      }
      <!--  -->
      @if(task.saved){
      <button class="save" (click)="saveTask($index)">
        <img src="save.png" alt="save" />
      </button>
      }
    </div>
    }
  </section>

  <!-- //////////////////////////////////////////////////////////////////////// -->
  <div class="lists">
    <header class="header">My Todo Board</header>

    <section
      class="sec-2"
      (dragover)="onDragOver($event)"
      (drop)="
        dropTaskToMainList('todayTasks', getDropIndex($event, 'todayTasks'))
      "
    >
      <h3 class="title">Today</h3>
      <!-- //////////////////////////////////////////////////////////////////////////// -->
      @for(task of todayTasks; track $index){
      <div
        class="task-div"
        draggable="true"
        (dragstart)="onDragStart($index, 'todayTasks')"
        (mouseenter)="task.hover = true"
        (mouseleave)="task.hover = false"
        [ngStyle]="{
          border: task.hover
            ? '2px solid rgba(255, 255, 255, 0.556)'
            : '2px solid rgb(33, 29, 29)'
        }"
      >
        <!--  -->
        @if(!task.saved){
        <button
          class="circle"
          (click)="makeDeleteVisibleToday($index)"
          [ngStyle]="{
            opacity: task.marked || task.hover ? '1' : '0'
          }"
        >
          <!--  -->
          @if(task.marked){
          <img class="mark" src="checkmark.png" alt="checkmark" />
          }
        </button>
        }
        <div
          class="task"
          [ngStyle]="{
          padding: task.marked || task.hover && !task.saved ? '6px 6px 6px 20px' : '6px 0px',
        }"
        >
          @if(!task.saved){
          {{ task.task }}
          }@else {
          <form class="edit-form" (ngSubmit)="saveTaskToday($index)">
            <input
              class="task-edit"
              type="text"
              name="task-input"
              [(ngModel)]="task.task"
            />
          </form>
          }
        </div>
        @if(task.marked && task.hover && !task.saved){
        <button class="delete" (click)="deleteTaskToday($index)">
          <img src="delete.png" alt="delete-icon" />
        </button>
        }
        <!--  -->
        @if(task.hover && !task.saved){
        <button class="edit" (click)="editTaskToday($index)">
          <img src="pen.png" alt="edit" />
        </button>
        }
        <!--  -->
        @if(task.saved){
        <button class="save" (click)="saveTaskToday($index)">
          <img src="save.png" alt="save" />
        </button>
        }
      </div>
      }
    </section>

    <!-- //////////////////////////////////////////////////////////////////////////////// -->
    @for(list of newSectionArray(); track $index; let sectionIndex = $index){
    <!--  -->
    @if(list.exist){
    <section
      class="sec-2"
      (dragover)="onDragOver($event)"
      (drop)="
        dropTaskToSection(
          sectionIndex,
          getDropIndex($event, 'section', sectionIndex)
        )
      "
    >
      <div class="section-header">
        @if(!list.clickOnTitle){
        <form class="title" (click)="changeTitle(sectionIndex)">
          {{ list.title || "New Section" }}
        </form>
        }@else{
        <form
          class="title title-form"
          (ngSubmit)="saveSectionTitle(sectionIndex)"
        >
          <input
            type="text"
            [(ngModel)]="list.title"
            autofocus
            name="edit-{{ sectionIndex }}"
            [value]="list.title"
          />
        </form>
        }
        <button class="delete-section" (click)="deleteSection(sectionIndex)">
          <img src="delete.png" alt="delete-section" />
        </button>
      </div>

      <!-- Add task form for section -->
      <!-- <form class="title" (ngSubmit)="addTaskToSection(sectionIndex)">
        <input
          type="text"
          [(ngModel)]="list.newTask"
          name="section-task-{{ sectionIndex }}"
          placeholder="Add task to {{ list.title }}..."
        />
        <button type="submit">Add Task</button>
      </form> -->

      @for(task of list.tasks; track $index; let taskIndex = $index){
      <div
        class="task-div"
        draggable="true"
        (dragstart)="onDragStartFromSection(taskIndex, sectionIndex)"
        (mouseenter)="task.hover = true"
        (mouseleave)="task.hover = false"
        [ngStyle]="{
          border: task.hover
            ? '2px solid rgba(255, 255, 255, 0.556)'
            : '2px solid rgb(33, 29, 29)'
        }"
      >
        <!--  -->
        @if(!task.saved){
        <button
          class="circle"
          (click)="makeDeleteVisibleAddedSection(sectionIndex, taskIndex)"
          [ngStyle]="{
            opacity: task.marked || task.hover ? '1' : '0'
          }"
        >
          <!--  -->
          @if(task.marked){
          <img class="mark" src="checkmark.png" alt="checkmark" />
          }
        </button>
        }
        <div
          class="task"
          [ngStyle]="{
          padding: task.marked || task.hover && !task.saved ? '6px 6px 6px 20px' : '6px 0px',
        }"
        >
          @if(!task.saved){
          {{ task.task }}
          }@else {
          <form
            class="edit-form"
            (ngSubmit)="saveTaskFromSection(sectionIndex, taskIndex)"
          >
            <input
              class="task-edit"
              type="text"
              name="task-input"
              [(ngModel)]="task.task"
            />
          </form>
          }
        </div>
        @if(task.marked && task.hover && !task.saved){
        <button
          class="delete"
          (click)="deleteTaskFromSection(sectionIndex, taskIndex)"
        >
          <img src="delete.png" alt="delete-icon" />
        </button>
        }
        <!--  -->
        @if(task.hover && !task.saved){
        <button
          class="edit"
          (click)="editTaskFromSection(sectionIndex, taskIndex)"
        >
          <img src="pen.png" alt="edit" />
        </button>
        }
        <!--  -->
        @if(task.saved){
        <button
          class="save"
          (click)="saveTaskFromSection(sectionIndex, taskIndex)"
        >
          <img src="save.png" alt="save" />
        </button>
        }
      </div>
      }
    </section>
    } }

    <!-- /////////////////////////////////////////////////////////////////////////////// -->
    <div class="add-section" (click)="addSection()">
      <img
        [ngClass]="{ 'settings-spin': newSection() }"
        class="settings"
        src="settings.png"
        alt="settings"
      />
      <img
        [ngClass]="{ 'add-spin': newSection() }"
        class="add"
        src="add-white.png"
        alt="add"
      />

      <span class="tooltip">Add New Section</span>
    </div>
  </div>
</main>

<!-- //////////////////////////////////////////////////////////////////////// -->
@if (showUndoMessage()) {
<div class="undo">
  <img class="info" src="info.png" alt="info" />
  <img
    class="close"
    src="close-icon.png"
    alt="close-icon"
    (click)="closeUndo()"
  />
  <p>Task Achieved</p>
  <button (click)="undoDelete()">UNDO</button>
</div>
}
